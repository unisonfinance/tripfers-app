rules_version = '2'; 
service cloud.firestore { 
  match /databases/{database}/documents { 

    // Helper: Check if user is admin 
    function isAdmin() { 
      return request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'ADMIN'; 
    }  

    // Helper: Check if user is authenticated 
    function isAuth() { 
      return request.auth != null; 
    } 

    // Global admin override 
    match /{document=**} { 
      allow read, write: if isAdmin(); 
    } 

    // --------------------------------------------------------- 
    // ï¿½ OPEN PERMISSIONS FOR DEV/TESTING (As Requested)
    // --------------------------------------------------------- 
    // Since we are bypassing Auth for quick role switching, 
    // we must allow writes from unauthenticated clients for now.
    
    match /users/{userId} { 
      allow read, write: if true; 
    } 

    match /bookings/{bookingId} { 
      allow read, write: if true; 
    } 

    match /tickets/{ticketId} { 
      allow read, write: if true; 
    } 

    match /transactions/{txId} { 
      allow read, write: if true; 
    } 

    match /notifications/{notifId} { 
      allow read, write: if true; 
    } 

    match /settings/{document=**} { 
      allow read, write: if true; 
    } 

    match /promo_codes/{codeId} { 
      allow read, write: if true; 
    } 

    match /audit_logs/{logId} { 
      allow read, write: if true; 
    } 
  } 
}